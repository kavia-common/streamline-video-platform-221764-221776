{"is_source_file": true, "format": "Python", "description": "This script initializes and seeds the SQLite database for the 'streaming_database' project. It creates tables for users, categories, videos, video categories, watch history, and app info. It also seeds demo data, sets up connection files, and provides an initialization routine for the database schema.", "external_files": ["os", "sqlite3", "hashlib", "typing"], "external_methods": ["os.getenv", "os.path.abspath", "os.path.join", "os.path.exists", "os.makedirs", "sqlite3.connect", "sqlite3.Cursor.execute", "hashlib.sha256"], "published": ["initialize_database"], "classes": [], "methods": [{"name": "None _ensure_column(cursor: sqlite3.Cursor, table: str, column_def: str)", "description": "Ensures a specified column exists in a table, adding it if missing, for simple schema migrations.", "scope": "", "scopeKind": ""}, {"name": "None _create_schema(cursor: sqlite3.Cursor)", "description": "Creates all necessary tables for the streaming database if they do not exist.", "scope": "", "scopeKind": ""}, {"name": "str _hash_password(password: str)", "description": "Hashes a password string with SHA-256 for demo purposes.", "scope": "", "scopeKind": ""}, {"name": "None _seed_app_info(cursor: sqlite3.Cursor)", "description": "Seeds core application metadata into the app_info table in an idempotent way.", "scope": "", "scopeKind": ""}, {"name": "int _seed_demo_user(cursor: sqlite3.Cursor)", "description": "Seeds a demo user account with a hashed password and returns its ID.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,int] _seed_categories(cursor: sqlite3.Cursor)", "description": "Seeds predefined video categories and returns a mapping of category name to ID.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,int] _seed_videos(cursor: sqlite3.Cursor, category_ids: Dict[str, int])", "description": "Seeds demo videos and their category relationships, returning a mapping of slug to video ID.", "scope": "", "scopeKind": ""}, {"name": "None _seed_watch_history( cursor: sqlite3.Cursor, demo_user_id: int, video_ids: Dict[str, int] )", "description": "Seeds sample watch history data for the demo user based on video IDs.", "scope": "", "scopeKind": ""}, {"name": "None _write_connection_files()", "description": "Creates files with connection information for external tools.", "scope": "", "scopeKind": ""}, {"name": "None initialize_database()", "description": "Main function to create or upgrade the database schema, seed demo data, and generate connection helpers.", "scope": "", "scopeKind": ""}], "calls": ["os.path.dirname", "os.path.abspath", "os.getenv", "os.path.join", "os.path.exists", "os.makedirs", "sqlite3.connect", "conn.execute", "cursor.execute", "cursor.fetchall", "cursor.fetchone", "conn.commit", "conn.close"], "search-terms": ["init_db", "SQLite schema creation", "database seeding", "demo user", "multiple seed tables", "connection file generation", "schema migration", "app_info", "videos", "categories", "watch_history"], "state": 2, "file_id": 5, "knowledge_revision": 20, "git_revision": "db23b0da2c0d25e921a10c7076a57447c81e1913", "revision_history": [{"17": "db23b0da2c0d25e921a10c7076a57447c81e1913"}, {"20": "db23b0da2c0d25e921a10c7076a57447c81e1913"}], "ctags": [{"_type": "tag", "name": "BASE_DIR", "path": "/home/kavia/workspace/code-generation/streamline-video-platform-221764-221776/streaming_database/init_db.py", "pattern": "/^BASE_DIR = os.path.dirname(os.path.abspath(__file__))$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "DB_PASSWORD", "path": "/home/kavia/workspace/code-generation/streamline-video-platform-221764-221776/streaming_database/init_db.py", "pattern": "/^DB_PASSWORD = \"kaviadefaultpassword\"  # Not used for SQLite, but kept for consistency$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "DB_PATH", "path": "/home/kavia/workspace/code-generation/streamline-video-platform-221764-221776/streaming_database/init_db.py", "pattern": "/^    DB_PATH = os.path.abspath(env_db_path)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "DB_PORT", "path": "/home/kavia/workspace/code-generation/streamline-video-platform-221764-221776/streaming_database/init_db.py", "pattern": "/^DB_PORT = \"5000\"  # Not used for SQLite, but kept for consistency$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "DB_USER", "path": "/home/kavia/workspace/code-generation/streamline-video-platform-221764-221776/streaming_database/init_db.py", "pattern": "/^DB_USER = \"kaviasqlite\"  # Not used for SQLite, but kept for consistency$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "DEFAULT_DB_FILENAME", "path": "/home/kavia/workspace/code-generation/streamline-video-platform-221764-221776/streaming_database/init_db.py", "pattern": "/^DEFAULT_DB_FILENAME = \"myapp.db\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_create_schema", "path": "/home/kavia/workspace/code-generation/streamline-video-platform-221764-221776/streaming_database/init_db.py", "pattern": "/^def _create_schema(cursor: sqlite3.Cursor) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(cursor: sqlite3.Cursor)"}, {"_type": "tag", "name": "_ensure_column", "path": "/home/kavia/workspace/code-generation/streamline-video-platform-221764-221776/streaming_database/init_db.py", "pattern": "/^def _ensure_column(cursor: sqlite3.Cursor, table: str, column_def: str) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(cursor: sqlite3.Cursor, table: str, column_def: str)"}, {"_type": "tag", "name": "_hash_password", "path": "/home/kavia/workspace/code-generation/streamline-video-platform-221764-221776/streaming_database/init_db.py", "pattern": "/^def _hash_password(password: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(password: str)"}, {"_type": "tag", "name": "_seed_app_info", "path": "/home/kavia/workspace/code-generation/streamline-video-platform-221764-221776/streaming_database/init_db.py", "pattern": "/^def _seed_app_info(cursor: sqlite3.Cursor) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(cursor: sqlite3.Cursor)"}, {"_type": "tag", "name": "_seed_categories", "path": "/home/kavia/workspace/code-generation/streamline-video-platform-221764-221776/streaming_database/init_db.py", "pattern": "/^def _seed_categories(cursor: sqlite3.Cursor) -> Dict[str, int]:$/", "language": "Python", "typeref": "typename:Dict[str,int]", "kind": "function", "signature": "(cursor: sqlite3.Cursor)"}, {"_type": "tag", "name": "_seed_demo_user", "path": "/home/kavia/workspace/code-generation/streamline-video-platform-221764-221776/streaming_database/init_db.py", "pattern": "/^def _seed_demo_user(cursor: sqlite3.Cursor) -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "(cursor: sqlite3.Cursor)"}, {"_type": "tag", "name": "_seed_videos", "path": "/home/kavia/workspace/code-generation/streamline-video-platform-221764-221776/streaming_database/init_db.py", "pattern": "/^def _seed_videos(cursor: sqlite3.Cursor, category_ids: Dict[str, int]) -> Dict[str, int]:$/", "language": "Python", "typeref": "typename:Dict[str,int]", "kind": "function", "signature": "(cursor: sqlite3.Cursor, category_ids: Dict[str, int])"}, {"_type": "tag", "name": "_seed_watch_history", "path": "/home/kavia/workspace/code-generation/streamline-video-platform-221764-221776/streaming_database/init_db.py", "pattern": "/^def _seed_watch_history($/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "( cursor: sqlite3.Cursor, demo_user_id: int, video_ids: Dict[str, int] )"}, {"_type": "tag", "name": "_write_connection_files", "path": "/home/kavia/workspace/code-generation/streamline-video-platform-221764-221776/streaming_database/init_db.py", "pattern": "/^def _write_connection_files() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "env_db_path", "path": "/home/kavia/workspace/code-generation/streamline-video-platform-221764-221776/streaming_database/init_db.py", "pattern": "/^env_db_path = os.getenv(\"SQLITE_DB\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "initialize_database", "path": "/home/kavia/workspace/code-generation/streamline-video-platform-221764-221776/streaming_database/init_db.py", "pattern": "/^def initialize_database() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}], "hash": "e5e599048452c849805e4921a66184d5", "format-version": 4, "code-base-name": "streaming_database", "filename": "streaming_database/init_db.py", "fields": [{"name": "BASE_DIR = os.path.dirname(os.path.abspath(__file__))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "DB_PASSWORD = \"kaviadefaultpassword\"  # Not used for SQLite, but kept for consistency", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "DB_PATH = os.path.abspath(env_db_path)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "DB_PORT = \"5000\"  # Not used for SQLite, but kept for consistency", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "DB_USER = \"kaviasqlite\"  # Not used for SQLite, but kept for consistency", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "DEFAULT_DB_FILENAME = \"myapp.db\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "env_db_path = os.getenv(\"SQLITE_DB\")", "scope": "", "scopeKind": "", "description": "unavailable"}]}